
# البصمة الجينية للمشروع

## نظرة عامة على المشروع

هذا المشروع هو تطبيق ويب مبني باستخدام React و Vite. يستخدم TypeScript للتحقق من الأنواع و Tailwind CSS للتصميم. يتضمن المشروع أيضًا عددًا من المكتبات الأخرى لميزات مثل التوجيه وإدارة الحالة والنماذج والمكونات.

## شجرة المجلدات

```
.
├── public
│   ├── logo.png
│   ├── manifest.json
│   ├── placeholder.svg
│   └── robots.txt
├── src
│   ├── assets
│   ├── components
│   │   ├── scheduler
│   │   └── ui
│   ├── contexts
│   ├── hooks
│   ├── lib
│   ├── pages
│   └── test
├── README.md
├── components.json
├── eslint.config.js
├── index.html
├── package-lock.json
├── package.json
├── postcss.config.js
├── tailwind.config.ts
├── tsconfig.app.json
├── tsconfig.json
├── tsconfig.node.json
├── vite.config.ts
└── vitest.config.ts
```

## فهرس الملفات

- **`public/`**: يحتوي على الأصول الثابتة التي يتم تقديمها مباشرة إلى المتصفح.
- **`src/`**: يحتوي على الكود المصدري للتطبيق.
- **`src/components/`**: يحتوي على مكونات React القابلة لإعادة الاستخدام.
- **`src/contexts/`**: يحتوي على سياقات React لإدارة الحالة.
- **`src/hooks/`**: يحتوي على خطافات React المخصصة.
- **`src/lib/`**: يحتوي على وظائف ومكتبات مساعدة.
- **`src/pages/`**: يحتوي على مكونات الصفحة التي يتم عرضها بواسطة React Router.
- **`src/test/`**: يحتوي على ملفات الاختبار.
- **`package.json`**: يسرد تبعيات المشروع والنصوص.
- **`vite.config.ts`**: ملف تكوين Vite.
- **`tailwind.config.ts`**: ملف تكوين Tailwind CSS.
- **`tsconfig.json`**: ملف تكوين TypeScript.

## الأكواد المصدرية

### `src/App.tsx`

```tsx
import { useState, useEffect } from 'react';
import { Toaster } from "@/components/ui/toaster";
import { Toaster as Sonner } from "@/components/ui/sonner";
import { TooltipProvider } from "@/components/ui/tooltip";
import { QueryClient, QueryClientProvider } from "@tanstack/react-query";
import { BrowserRouter, Routes, Route, Navigate } from "react-router-dom";
import { AuthProvider, useAuth } from "@/contexts/AuthContext";
import Index from "./pages/Index";
import Auth from "./pages/Auth";
import Tournaments from "./pages/Tournaments";
import Clubs from "./pages/Clubs";
import Channels from "./pages/Channels";
import Commentators from "./pages/Commentators";
import Scheduler from "./pages/Scheduler";
import Manage from "./pages/Manage";
import Profile from "./pages/Profile";
import NotFound from "./pages/NotFound";
import { Loader2, Download } from "lucide-react";
import SplashScreen from './components/ui/SplashScreen';
import { Button } from './components/ui/button';

const queryClient = new QueryClient();

// Unchanged from previous version
const ProtectedRoute = ({ children }: { children: React.ReactNode }) => {
  const { user, loading } = useAuth();
  if (loading) return (
    <div className="min-h-screen flex items-center justify-center bg-background">
      <Loader2 className="w-8 h-8 animate-spin text-primary" />
    </div>
  );
  if (!user) return <Navigate to="/auth" replace />;
  return <>{children}</>;
};

// Unchanged from previous version
const AuthRoute = ({ children }: { children: React.ReactNode }) => {
  const { user, loading } = useAuth();
  if (loading) return (
    <div className="min-h-screen flex items-center justify-center bg-background">
      <Loader2 className="w-8 h-8 animate-spin text-primary" />
    </div>
  );
  if (user) return <Navigate to="/" replace />;
  return <>{children}</>;
};

const AppRoutes = () => (
  <Routes>
    <Route path="/auth" element={<AuthRoute><Auth /></AuthRoute>} />
    <Route path="/" element={<ProtectedRoute><Index /></ProtectedRoute>} />
    <Route path="/manage" element={<ProtectedRoute><Manage /></ProtectedRoute>} />
    <Route path="/tournaments" element={<ProtectedRoute><Tournaments /></ProtectedRoute>} />
    <Route path="/clubs" element={<ProtectedRoute><Clubs /></ProtectedRoute>} />
    <Route path="/channels" element={<ProtectedRoute><Channels /></ProtectedRoute>} />
    <Route path="/commentators" element={<ProtectedRoute><Commentators /></ProtectedRoute>} />
    <Route path="/scheduler" element={<ProtectedRoute><Scheduler /></ProtectedRoute>} />
    <Route path="/profile" element={<ProtectedRoute><Profile /></ProtectedRoute>} />
    <Route path="*" element={<NotFound />} />
  </Routes>
);

const App = () => {
  const [showSplash, setShowSplash] = useState(true);
  const [installPrompt, setInstallPrompt] = useState<any>(null);
  const [showInstallBanner, setShowInstallBanner] = useState(false);

  useEffect(() => {
    // Force SplashScreen for 2 seconds
    const splashTimer = setTimeout(() => {
      setShowSplash(false);
    }, 2000);

    const handleBeforeInstallPrompt = (event: Event) => {
      event.preventDefault();
      setInstallPrompt(event);
      setShowInstallBanner(true);
    };

    window.addEventListener('beforeinstallprompt', handleBeforeInstallPrompt);

    return () => {
      clearTimeout(splashTimer);
      window.removeEventListener('beforeinstallprompt', handleBeforeInstallPrompt);
    };
  }, []);

  const handleInstallClick = () => {
    if (!installPrompt) return;
    installPrompt.prompt();
    installPrompt.userChoice.then(() => {
      setShowInstallBanner(false);
      setInstallPrompt(null);
    });
  };

  return (
    <QueryClientProvider client={queryClient}>
      <TooltipProvider>
        <Toaster />
        <Sonner />
        <SplashScreen show={showSplash} />

        {showInstallBanner && (
          <div className="fixed bottom-20 right-4 z-50 bg-secondary text-secondary-foreground p-3 rounded-lg shadow-lg flex items-center gap-4 animate-in fade-in slide-in-from-bottom-5">
            <p className="text-sm font-semibold">تجربة أفضل؟ ثبت التطبيق على جهازك</p>
            <Button onClick={handleInstallClick} size="sm">
              <Download className="w-4 h-4 ml-2" />
              تثبيت
            </Button>
          </div>
        )}

        <BrowserRouter>
          <AuthProvider>
            <div className={showSplash ? 'invisible' : 'visible'}>
              <AppRoutes />
            </div>
          </AuthProvider>
        </BrowserRouter>
      </TooltipProvider>
    </QueryClientProvider>
  );
};

export default App;
```

### `vite.config.ts`

```ts
import path from "path";
import react from "@vitejs/plugin-react";
import { defineConfig } from "vite";
import { VitePWA } from "vite-plugin-pwa";

export default defineConfig({
  plugins: [
    react(),
    VitePWA({
      registerType: "autoUpdate",
      strategies: 'generateSW',
      workbox: {
        globPatterns: ["**/*.{js,css,html,ico,png,svg}"],
      },
      // This section will now automatically generate icons and the manifest.
      includeAssets: ["/logo.png"],
      manifest: {
        "short_name": "الرياضي الذكي",
        "name": "الرياضي الذكي | AI-Uncode",
        "description": "نظام إدارة المحتوى الرياضي بدعم من AI-Uncode. المدير التنفيذي: المهندس توفيق العبدلي",
        "icons": [
          {
            "src": "/pwa-192x192.png",
            "sizes": "192x192",
            "type": "image/png",
            "purpose": "any"
          },
          {
            "src": "/pwa-512x512.png",
            "sizes": "512x512",
            "type": "image/png",
            "purpose": "any"
          },
          {
            "src": "/pwa-maskable-512x512.png",
            "sizes": "512x512",
            "type": "image/png",
            "purpose": "maskable"
          }
        ],
        "start_url": "/",
        "display": "standalone",
        "theme_color": "#020617",
        "background_color": "#020617"
      },
      // This will add the apple-touch-icon link to the index.html
      devOptions: {
        enabled: true,
      },
    }),
  ],
  resolve: {
    alias: {
      "@": path.resolve(__dirname, "./src"),
    },
  },
});
```

## خريطة الاعتمادات

### التبعيات (Dependencies)

- **`@hookform/resolvers`**:  يستخدم مع `react-hook-form` للتحقق من صحة النموذج.
- **`@radix-ui/*`**:  مجموعة من مكونات واجهة المستخدم البدائية التي يمكن الوصول إليها.
- **`@supabase/supabase-js`**:  مكتبة العميل لـ Supabase ، وهي منصة مفتوحة المصدر كبديل لـ Firebase.
- **`@tanstack/react-query`**:  مكتبة لجلب البيانات وتخزينها مؤقتًا وتحديثها.
- **`class-variance-authority`**:  أداة لإنشاء متغيرات فئة Tailwind CSS.
- **`clsx`**:  أداة مساعدة لإنشاء سلاسل أسماء الفئات الشرطية.
- **`cmdk`**:  مكون لوحة الأوامر.
- **`date-fns`**:  مكتبة لمعالجة التواريخ.
- **`embla-carousel-react`**:  مكون دائري قابل للتخصيص.
- **`input-otp`**:  مكون لإدخال كلمة المرور لمرة واحدة.
- **`lucide-react`**:  مجموعة من أيقونات SVG.
- **`next-themes`**:  يسمح بتبديل السمات في تطبيقات Next.js (يستخدم هنا مع React).
- **`react`**:  المكتبة الأساسية لبناء واجهات المستخدم.
- **`react-day-picker`**:  مكون منتقي التاريخ.
- **`react-dom`**:  يوفر طرقًا خاصة بـ DOM لـ React.
- **`react-hook-form`**:  مكتبة لإدارة النماذج.
- **`react-resizable-panels`**:  مكونات لوحة قابلة لتغيير الحجم.
- **`react-router-dom`**:  يوفر التوجيه من جانب العميل.
- **`recharts`**:  مكتبة رسوم بيانية.
- **`sonner`**:  مكتبة إشعارات.
- **`tailwind-merge`**:  أداة لدمج فئات Tailwind CSS.
- **`tailwindcss-animate`**:  يضيف رسومًا متحركة إلى Tailwind CSS.
- **`vaul`**:  مكون درج قابل للسحب.
- **`zod`**:  مكتبة للتحقق من صحة المخطط.

### تبعيات التطوير (Dev Dependencies)

- **`@eslint/js`**:  قواعد ESLint الأساسية.
- **`@tailwindcss/typography`**:  يضيف أنماطًا افتراضية للطباعة إلى Tailwind CSS.
- **`@testing-library/*`**:  مكتبات لاختبار مكونات React.
- **`@types/*`**:  تعريفات TypeScript للمكتبات المختلفة.
- **`@vitejs/plugin-react`**:  المكون الإضافي الرسمي لـ Vite لدعم React.
- **`autoprefixer`**:  يضيف بادئات البائع إلى قواعد CSS.
- **`eslint`**:  أداة تحليل الكود الثابت.
- **`globals`**:  المعرفات العامة لـ ESLint.
- **`jsdom`**:  تنفيذ لمعايير الويب للاستخدام مع Node.js.
- **`postcss`**:  أداة لتحويل CSS باستخدام JavaScript.
- **`tailwindcss`**:  إطار عمل CSS أولاً.
- **`typescript`**:  لغة برمجة مكتوبة تضيف أنواعًا إلى JavaScript.
- **`vite`**:  أداة بناء الواجهة الأمامية.
- **`vite-plugin-pwa`**:  مكون إضافي لإنشاء تطبيقات ويب تقدمية (PWAs).
- **`vitest`**:  إطار اختبار مدعوم من Vite.

## العلاقات بين المكونات

- **`App.tsx`** هو المكون الجذر الذي يقوم بإعداد التوجيه ومزودي السياق.
- يتم تعريف المسارات في `App.tsx` باستخدام `react-router-dom`.
- يتم استخدام المكونات المحمية (`ProtectedRoute` و `AuthRoute`) للتحكم في الوصول إلى المسارات بناءً على حالة المصادقة.
- يتم توفير حالة المصادقة بواسطة `AuthContext`.
- يتم استخدام `@tanstack/react-query` لجلب البيانات وإدارتها.
- يتم استخدام مكونات واجهة المستخدم من `@radix-ui` و `shadcn/ui` في جميع أنحاء التطبيق.

## الإعدادات والبيئة

- يتم تكوين Vite في `vite.config.ts`.
- يتم تكوين Tailwind CSS في `tailwind.config.ts`.
- يتم تكوين TypeScript في `tsconfig.json`.
- يتم تكوين ESLint في `eslint.config.js`.

## الملفات المتجاهلة

- **`node_modules/`**:  يحتوي على جميع تبعيات المشروع.
- **`dist/`**:  يحتوي على مخرجات البناء.
- **`.git/`**:  يحتوي على معلومات التحكم في إصدار Git.
- **ملفات ثنائية وملفات كبيرة**: تم تجاهلها أثناء التحليل.

## ملاحظات المخاطر والسلامة الهيكلية

- **الاعتماد على Supabase**:  يعتمد التطبيق بشكل كبير على Supabase للمصادقة وقاعدة البيانات. أي مشاكل مع Supabase ستؤثر على التطبيق.
- **التحقق من صحة الإدخال**:  يتم استخدام Zod للتحقق من صحة النموذج ، وهو أمر جيد. ومع ذلك ، يجب التأكد من أن جميع مدخلات المستخدم يتم التحقق من صحتها على الخادم أيضًا.
- **إدارة الحالة**:  يتم استخدام `useState` و `useContext` و `react-query` لإدارة الحالة. قد يصبح هذا معقدًا مع نمو التطبيق. قد يكون من المفيد التفكير في حل أكثر قوة لإدارة الحالة مثل Redux أو Zustand.

